{"remainingRequest":"/Users/apple/Desktop/vueprototype/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/apple/Desktop/vueprototype/src/pages/admin/role/manage/index.vue?vue&type=style&index=0&id=bd991ee6&lang=less&scoped=true&","dependencies":[{"path":"/Users/apple/Desktop/vueprototype/src/pages/admin/role/manage/index.vue","mtime":1599616394000},{"path":"/Users/apple/Desktop/vueprototype/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/Desktop/vueprototype/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/apple/Desktop/vueprototype/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/apple/Desktop/vueprototype/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/Desktop/vueprototype/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/Desktop/vueprototype/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5zbGlkZS1mYWRlLWVudGVyLWFjdGl2ZSB7CiAgdHJhbnNpdGlvbjogYWxsIC41cyBlYXNlOwp9Ci5zbGlkZS1mYWRlLWxlYXZlLWFjdGl2ZSB7CiAgdHJhbnNpdGlvbjogYWxsIC41cyBlYXNlOwp9Ci5zbGlkZS1mYWRlLWVudGVyLCAuc2xpZGUtZmFkZS1sZWF2ZS10bwovKiAuc2xpZGUtZmFkZS1sZWF2ZS1hY3RpdmUgZm9yIGJlbG93IHZlcnNpb24gMi4xLjggKi8gewogIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgxMHB4KTsKICBvcGFjaXR5OiAwOwp9Ci5yb2xlLW1hbmFnZSB7CiAgcGFkZGluZzogMjBweDsKICAub3BlcmF0b3JzIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBwYWRkaW5nLXRvcDogMjBweDsKICB9CiAgLnRhYmxlLWxpc3QgewogICAgbWFyZ2luOiAyMHB4IDAgMCAwOwogICAgYmFja2dyb3VuZDogI2ZmZjsKICAgIC9kZWVwLyAuZWwtaW5wdXQgewogICAgICB3aWR0aDogODAlOwogICAgfQogIH0KICAub3BlcmF0b3JzIC9kZWVwLyAuZWwtaW5wdXQgewogICAgd2lkdGg6IDI1MHB4OwogIH0KICAucGFnaW5hdGlvbiB7CiAgICBwYWRkaW5nOiA1MHB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICB9CiAgL2RlZXAvIC5lbC1idXR0b24gewogICAgbWFyZ2luOiAwIDAgMCAyMHB4OwogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/admin/role/manage","sourcesContent":["<template>\n  <div class=\"role-manage\">\n    <div class=\"table-list\">\n      <div class=\"operators\">\n        <el-button\n          type=\"primary\"\n          class=\"fa fa-plus-circle fa-lg\"\n          size=\"small\"\n          @click=\"add\"\n          >&nbsp;角色新增</el-button\n        >\n      </div>\n      <el-table\n        ref=\"table\"\n        :data=\"\n          tableData.filter(\n            (data) =>\n              !codeSearch ||\n              data.roleName.toLowerCase().includes(codeSearch.toLowerCase())\n          )\n        \"\n        style=\"width: 100%\"\n        header-row-class-name=\"headerRow\"\n        :header-cell-style=\"{ background: '#eef1f6', color: '#606266' }\"\n      >\n        <el-table-column prop=\"roleName\" label=\"角色\" align=\"center\">\n          <template slot-scope=\"scope\">\n            <el-input\n              v-if=\"scope.row.isAdd || scope.row.isEdit\"\n              v-model=\"scope.row.roleName\"\n              size=\"small\"\n              placeholder=\"请设置角色名\"\n            />\n            <span v-else>{{ scope.row.roleName }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column align=\"center\">\n          <template slot=\"header\">\n            <el-input\n              v-model=\"codeSearch\"\n              size=\"small\"\n              placeholder=\"输入角色名进行搜索\"\n            />\n          </template>\n          <template slot-scope=\"scope\">\n            <el-button\n              type=\"primary\"\n              v-if=\"!scope.row.isAdd && !scope.row.isEdit\"\n              size=\"mini\"\n              @click=\"handleEdit(scope.row)\"\n              >编辑</el-button\n            >\n            <el-button\n              v-if=\"!scope.row.isAdd && !scope.row.isEdit\"\n              size=\"mini\"\n              type=\"warning\"\n              @click=\"handleDelete(scope.row)\"\n              >删除</el-button\n            >\n            <el-button\n              v-if=\"!scope.row.isAdd && !scope.row.isEdit\"\n              size=\"mini\"\n              type=\"primary\"\n              @click=\"handleRole(scope.row)\"\n              >权限配置</el-button\n            >\n            <el-button\n              type=\"primary\"\n              v-if=\"scope.row.isAdd || scope.row.isEdit\"\n              size=\"mini\"\n              @click=\"handleComplete(scope.row)\"\n              >完成</el-button\n            >\n            <el-button\n              v-if=\"scope.row.isAdd || scope.row.isEdit\"\n              size=\"mini\"\n              type=\"warning\"\n              @click=\"handleCancel(scope.$index, scope.row)\"\n              >取消</el-button\n            >\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n    <div class=\"pagination\">\n      <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"page\"\n        :page-sizes=\"[10, 20, 30, 40]\"\n        :page-size=\"limit\"\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :total=\"total\"\n      ></el-pagination>\n    </div>\n    <transition name=\"slide-fade\" mode=\"out-in\">\n      <role-card v-if=\"showRoleCard\" v-on:cancel-set='cancelSet' v-on:confirm-set='confirmSet' :authorities='authorities'></role-card>\n    </transition>\n  </div>\n</template>\n\n<script>\nimport roleCard from '../../../../components/role/manage/handlerole';\nexport default {\n  data() {\n    return {\n      key: \"\",\n      tableData: [],\n      codeSearch: \"\",\n      page: 1,\n      limit: 10,\n      total: 0,\n      // 所有字典分类\n      authorities: [],\n      showRoleCard:false\n    };\n  },\n  components: {\n    \"role-card\":roleCard\n  },\n  methods: {\n    handleSizeChange(pageSize) {\n      this.limit = pageSize;\n      this.search();\n    },\n    handleCurrentChange(current) {\n      this.page = current;\n      this.search();\n    },\n    search() {\n      this.$axios({\n        url: \"/api-admin/role/list\",\n        type: \"get\",\n        data: {\n          page: this.page,\n          limit: this.limit,\n          title: this.key,\n        },\n      })\n        .then((res) => {\n          const page = (res || {}).page || {};\n          this.tableData = page.rows || [];\n          this.total = +page.total;\n        })\n        .catch((err) => {\n          this.$message({\n            message: err.msg || \"获取角色列表失败\",\n          });\n        });\n    },\n    add() {\n      //增加表格行\n      this.tableData.unshift({\n        roleName: \"\",\n        isAdd: true,\n      });\n    },\n    handleComplete(row) {\n      //校验\n      if (!row.roleName) {\n        this.$message({\n          type: \"info\",\n          message: \"请输入角色名\",\n        });\n      } else {\n        //区分是新增还是编辑\n        if (row.isAdd) {\n          this.$axios({\n            url: \"/api-admin/role/add\",\n            type: \"post\",\n            data: {\n              roleName: row.roleName,\n            },\n          })\n            .then((res) => {\n              this.search();\n            })\n            .catch((err) => {\n              this.$message({\n                type: \"error\",\n                message: err.msg || \"角色新增失败\",\n              });\n            });\n        }\n        if (row.isEdit) {\n          this.$axios({\n            url: \"/api-admin/role/update\",\n            type: \"post\",\n            data: {\n              roleId: row.roleId,\n              roleName: row.roleName,\n            },\n          })\n            .then((res) => {\n              this.search();\n            })\n            .catch((err) => {\n              this.$message({\n                type: \"error\",\n                message: err.msg || \"角色修改失败\",\n              });\n            });\n        }\n      }\n    },\n    handleCancel(index, row) {\n      //区分是新增还是编辑\n      if(row.isAdd){\n        //删除表格行\n      this.tableData.splice(index, 1);\n      }\n      if(row.isEdit){\n        this.$set(row,'isEdit',false)\n      }\n    },\n    handleEdit(row) {\n      console.log(row);\n      this.$set(row, \"isEdit\", true);\n    },\n    handleDelete({ roleId }) {\n      console.log(roleId)\n      this.$confirm(\"是否确认删除此角色?\", \"安全提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n        .then(() => {\n          this.$axios({\n            url: \"/api-admin/role/delete\",\n            type: \"post\",\n            data: {\n              roleId,\n            },\n          })\n            .then((res) => {\n              this.$message({\n                type: \"success\",\n                message: \"删除成功!\",\n              });\n              this.search();\n            })\n            .catch((err) => {\n              this.$message({\n                message: err.msg || \"删除失败\",\n              });\n            });\n        })\n        .catch(() => {});\n    },\n    handleRole(row){\n      this.showRoleCard = true;\n      this.$nextTick(_ => {\n        this.$trigger('handleRolesTree',row)\n      })\n    },\n    confirmSet(rowData){\n      console.log(rowData)\n      this.$axios({\n            url: \"/api-admin/role/update\",\n            type: \"post\",\n            data: {\n              roleId: rowData.roleId,\n              roleName: rowData.roleName,\n              menuIds: rowData.authority.join(',')\n            },\n          })\n            .then((res) => {\n              let {code,msg} = res;\n              if(code != 0) return this.$message({\n                type:'error',\n                message:msg || '配置失败'\n              })\n              this.$message({\n                type:'success',\n                message:msg || '配置成功'\n              })\n              this.showRoleCard = false\n              this.search();\n            })\n            .catch((err) => {\n              this.$message({\n                type: \"error\",\n                message: err.msg || \"权限配置失败\",\n              });\n            });\n    },\n    cancelSet(){\n      console.log('取消')\n      this.showRoleCard = false;\n    },\n    getAuthorities() {\n      this.$axios({\n        url: \"/api-admin/menu/list\",\n        type: \"get\",\n      })\n        .then((res) => {\n          this.authorities = res.page || [];\n        })\n        .catch((err) => {\n          this.$message({\n            message: err.msg || \"权限加载失败\",\n          });\n        });\n    },\n  },\n  created() {\n    this.getAuthorities();\n    this.search();\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.slide-fade-enter-active {\n  transition: all .5s ease;\n}\n.slide-fade-leave-active {\n  transition: all .5s ease;\n}\n.slide-fade-enter, .slide-fade-leave-to\n/* .slide-fade-leave-active for below version 2.1.8 */ {\n  transform: translateX(10px);\n  opacity: 0;\n}\n.role-manage {\n  padding: 20px;\n  .operators {\n    display: flex;\n    padding-top: 20px;\n  }\n  .table-list {\n    margin: 20px 0 0 0;\n    background: #fff;\n    /deep/ .el-input {\n      width: 80%;\n    }\n  }\n  .operators /deep/ .el-input {\n    width: 250px;\n  }\n  .pagination {\n    padding: 50px;\n    text-align: center;\n    background-color: #fff;\n  }\n  /deep/ .el-button {\n    margin: 0 0 0 20px;\n  }\n}\n</style>\n"]}]}